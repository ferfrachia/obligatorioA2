/** * $file: NamePicker.js $ * $Revision: 1.001 $ * $Date: 2006/06/23 $ * * @author Jake Howlett, codestore.net * @copyright Copyright Â© 2006, Rockall Design ltd, All rights reserved. */ var NamePicker = {	target_field: "",	target_type: "",	remember_last: false,	init: function(settings){		NamePicker.settings = settings;		$("search_results").innerHTML=this.settings["prompt"];	},	reset: function (){		Element.hide('search_spinner');		$("search_text").value="";		$("search_results").innerHTML=this.settings["prompt"];	},		open: function(caller, field, type, prompt){		if (!this.RememberLast)			this.reset();		this.target_field = field;		this.target_type = type;		$('NamesPickerLabel').innerHTML="<strong>"+prompt+"</strong>";		Element.setStyle('NamesPicker', {position: 'absolute', top: this.findPosY(caller)+"px", left: this.findPosX(caller)+"px"} );		if (type=="enlazada" || type=="singleenlazada"){			$('search_text').style.display="none";			NamePicker.list_options();			document.getElementById("NamesPicker").style.display="block";		}else{		new Form.Element.Observer('search_text', 1, this.lookup);		//new Effect.SlideDown('NamesPicker');		document.getElementById("NamesPicker").style.display="block"		$("search_text").style.display="block"		$("search_text").focus();		}		this.showIFrame();	},	close: function(){		//new Effect.SlideUp('NamesPicker');		document.getElementById("NamesPicker").style.display="none"		document.getElementById('DivShim').style.display="none"	},	add: function(name){		switch (this.target_type){			case "conroles":							vValores=stringToVector(document.forms[0].Nombres.value)				if (vValores.vIsMember(name)){					alert("La persona ya se encuentra ingresada")				}else{					var roles = stringToVector($(this.settings['roles_field']).value);					var row ="<tr>"					row+="<td class=\"tipoletranegra\">"+name+"</td>"					for(var i=0;i<roles.vLength;i++){						row+="<td align=\"center\"><input type=\"checkbox\" name=\""+roles.vArray[i]+i+"\" value=\""+name+"-"+roles.vArray[i]+"\" onclick=\"verificarRol(this)\"></td>"					}					row+="</tr>"						new Insertion.Bottom(NamePicker.target_field, row);					vValores.vAgregar(name)					document.forms[0].Nombres.value=VectorToString(vValores)				}			break;						case "single":				$(this.target_field).value = name;				//new Effect.Highlight(this.target_field, { queue: 'front' }); //'Message');				this.close();			break;						case "multi":				$(this.target_field).value+=name+'\n';			break;						case "table":				var vValores = StringToVector3(document.getElementById(this.target_field).value,",");				if (vValores.vIsMember(name)){					alert("La persona ya se encuentra agredada");				}else{					var empty=NamePicker.settings['empty'];					var row = "<tr>";					row+="<td class=\"tdSeleccion\">"+name+"</td>";					row+="<td class=\"tdSeleccion\"><img alt=\"Borrar&#013;"+name+"\" src=\"images/icons/remove.gif\" onclick=\"NamePicker.remove(this.parentNode.parentNode,'"+this.target_field+"','"+name+"',"+empty+")\" style=\"cursor:hand;\"></td>";					row+="</tr>";					vValores.vAgregar(name)					document.getElementById(this.target_field).value=VectorToString2(vValores,",")					new Insertion.Bottom(this.target_field+'-List', row);				}											break;			case "tableunidad":				var empty=NamePicker.settings['empty'];				var vValores = StringToVector3(document.getElementById(this.target_field).value,",");				if (vValores.vIsMember(name)){					alert("La unidad ya se encuentra agredada");				}else{					var row = "<tr>";					row+="<td class=\"tdSeleccion\">"+name+"</td>";					row+="<td class=\"tdSeleccion\"><img alt=\"Borrar&#013;"+name+"\" src=\"images/icons/remove.gif\" onclick=\"NamePicker.remove(this.parentNode.parentNode,'"+this.target_field+"','"+name+"',"+empty+")\" style=\"cursor:hand;\"></td>";					row+="</tr>";					vValores.vAgregar(name)					document.getElementById(this.target_field).value=VectorToString2(vValores,",")					new Insertion.Bottom(this.target_field+'-List', row);				}											break;			case "enlazada":				var vValores = StringToVector3(document.getElementById(this.target_field).value,",");				if (vValores.vIsMember(name)){					alert("La persona ya fue ingresada");				}else{					var row = "<tr>";					row+="<td class=\"tdSeleccion\">"+name+"</td>";					row+="<td class=\"tdSeleccion\"><img alt=\"Borrar&#013;"+name+"\" src=\"images/icons/remove.gif\" onclick=\"NamePicker.remove(this.parentNode.parentNode,'"+this.target_field+"','"+name+"')\"></td>";					row+="</tr>";					vValores.vAgregar(name)					document.getElementById(this.target_field).value=VectorToString2(vValores,",")					new Insertion.Bottom(this.target_field+'-List', row);				}											break;			case "singleenlazada":				var vValores = StringToVector3(document.getElementById(this.target_field).value,",");				if (vValores.vIsMember(name)){					alert("El tema ya fue ingresado");				}else{					document.getElementById(this.target_field).value=name;					this.close();				}							break;					}	},	lookup: function(element, value) {		if (value=="") return;			new Ajax.Request(      		  NamePicker.settings['addressbook']+'/'+NamePicker.settings['viewname']+'?readviewentries&count=10',         			{asynchronous:true, evalScripts:true,            			onSuccess:NamePicker.list_results,            			onLoading:function(request)            		{Element.show('search_spinner')},          	 	method:'get', parameters:'startkey=' + value }		)	},	list_results: function (response){		var root = response.responseXML;		var entries = root.getElementsByTagName("viewentry");			var outputHTML = "<table class='names'>";		outputHTML += "<col></col>"; 		outputHTML += "<col width='16'></col>";				var vValores;		if (NamePicker.target_type!="conroles"){			vValores = StringToVector3(document.getElementById(NamePicker.target_field).value,","); 				}else {			vValores=stringToVector(document.forms[0].Nombres.value)		}		for (var i=0; i<entries.length; i++) {			person= entries[i].getElementsByTagName("text").item(NamePicker.settings["column"]-1).firstChild.nodeValue;			if (vValores.vIsMember(person)){				outputHTML+= "<tr onclick=\"NamePicker.add(this.firstChild.innerHTML)\"><td style=\"color:red;\">"+person+"</td></tr>";			}else{				outputHTML+= "<tr onclick=\"NamePicker.add(this.firstChild.innerHTML)\"><td onclick=\"this.style.color='#FF0000';\">"+person+"</td></tr>";			}		}		outputHTML+= "</table>";		$('search_results').innerHTML = outputHTML;		var frame = document.getElementById('frameNamePicker')		frame.style.top=this.findPosY(caller)+"px"		frame.style.left=this.findPosX(caller)+"px"		frame.style.display=""  	     frame.style.width  = document.getElementById('NamesPicker').offsetWidth + "px";   		frame.style.height = document.getElementById('NamesPicker').offsetHeight + "px"		Element.hide('search_spinner');	},		list_options:function(){		valores = StringToVector3($(NamePicker.settings['campoOrigen']).value,',');		var vValores = StringToVector3(document.getElementById(NamePicker.target_field).value,",");		var outputHTML = "<table class='names'>";		outputHTML += "<col></col>"; 		outputHTML += "<col width='16'></col>";		for (var i=0; i<valores.vArray.length; i++) {			person= valores.vArray[i];			if (vValores.vIsMember(person)){				outputHTML+= "<tr onclick=\"NamePicker.add(this.firstChild.innerHTML)\"><td style=\"color:red;\">"+person+"</td></tr>";			}else{				outputHTML+= "<tr onclick=\"NamePicker.add(this.firstChild.innerHTML)\"><td onclick=\"this.style.color='#FF0000';\">"+person+"</td></tr>";			}		}		outputHTML+= "</table>";		var div = document.getElementById('search_results')		$('search_results').innerHTML = outputHTML;	},	remove: function (row,field,name,empty){		var vValores= new Vector(0)		vValores=StringToVector3(document.getElementById(field).value,",")		if (vValores.vArray.length>1 || empty){		ind = vValores.vIndice(name);		vValores.vBorrar(ind);				Element.remove(row);		document.getElementById(field).value=VectorToString2(vValores,",")			}else{			alert("No es posible eliminar todos los valores de este campo");		}	},			findPosX: function(obj) 	{			var curleft = 0;		if (obj.offsetParent)		{			while (obj.offsetParent)			{				curleft += obj.offsetLeft				obj = obj.offsetParent;			}		}		else if (obj.x)			curleft += obj.x;				return curleft;	},	findPosY: function(obj)	{		var curtop = 0;		if (obj.offsetParent)		{			while (obj.offsetParent)			{				curtop += obj.offsetTop				obj = obj.offsetParent;			}		}		else if (obj.y)			curtop += obj.y;					return curtop;	},	 showIFrame: function() 	 {	   	var DivRef = document.getElementById('NamesPicker');	 	var IfrRef = document.getElementById('DivShim'); 	  	IfrRef.style.width = DivRef.offsetWidth;	 	IfrRef.style.height = DivRef.offsetHeight;	    	IfrRef.style.top =  DivRef.style.top; 	 	IfrRef.style.left = DivRef.style.left; 	  	IfrRef.style.zIndex = DivRef.style.zIndex - 1;	  	IfrRef.style.display = "block";	 } }